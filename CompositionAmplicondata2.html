<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Leo Lahti, Sudarshan Shetty et al. 2019-07-26" />


<title>Microbiome composition for Amplicon data</title>

<script src="CompositionAmplicondata2_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="CompositionAmplicondata2_files/bootstrap-3.3.6/css/bootstrap.min.css" rel="stylesheet" />
<script src="CompositionAmplicondata2_files/bootstrap-3.3.6/js/bootstrap.min.js"></script>
<script src="CompositionAmplicondata2_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<script src="CompositionAmplicondata2_files/navigation-1.1/tabsets.js"></script>
<script src="CompositionAmplicondata2_files/navigation-1.1/codefolding.js"></script>
<link href="CompositionAmplicondata2_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
<script src="CompositionAmplicondata2_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
<link href="CompositionAmplicondata2_files/readthedown-0.1/readthedown.css" rel="stylesheet" />
<script src="CompositionAmplicondata2_files/readthedown-0.1/readthedown.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>


</head>

<body>


<div id="content" data-toggle="wy-nav-shift">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->

<nav id="nav-top" role="navigation" aria-label="top navigation">
    <a role="button" href="#" data-toggle="wy-nav-top"><span class="glyphicon glyphicon-menu-hamburger"></span></a>
</nav>


<div id="header">
<h1 class="title">Microbiome composition for Amplicon data</h1>
</div>


<div id="table-of-contents">
    <h2><a href="#content">Microbiome composition for Amplicon data</a></h2>
    <div id="text-table-of-contents">
      <ul>
      <li><a href="#composition-barplots">Composition barplots</a><ul>
      <li><a href="#plot-relative-abundance">Plot relative abundance</a></li>
      <li><a href="#plot-relative-abundance-1">Plot relative abundance</a></li>
      </ul></li>
      <li><a href="#heatmap-composition">Heatmap composition</a></li>
      <li><a href="#plot-taxa-prevalence">Plot taxa prevalence</a></li>
      </ul>
    </div>
</div>

<div id="main">
<p><!--
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{microbiome tutorial - composition}
  %\usepackage[utf8]{inputenc}
  %\VignetteEncoding{UTF-8}  
--></p>
<p>Also see <a href="http://joey711.github.io/phyloseq/plot_bar-examples.html">phyloseq barplot examples</a>.</p>
<p>Check the <a href="http://microbiome.github.io/microbiome/CoremicrobiotaAmplicon.html">core microbiome page</a> which shows how to read the your files into R and make a phyloseq object.</p>
<p>Here, an example data is used which is not available in the package currently due to size limitations. We will directly strat from a ready phyloseq object. Please test your own data and give your feedback on the <a href="https://github.com/microbiome/microbiome/issues">issues page</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Example data</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(microbiome)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co"># Try another theme</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># from https://github.com/hrbrmstr/hrbrthemes</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># you can install these if you don&#39;t have it already.</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># devtools::install_github(&quot;hrbrmstr/hrbrthemes&quot;)</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">library</span>(hrbrthemes)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">library</span>(gcookbook)</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">data</span>(<span class="st">&quot;DynamicsIBD&quot;</span>) <span class="co">#This data is currently unavialable due to size limitations</span></a>
<a class="sourceLine" id="cb1-13" title="13">ps1 &lt;-<span class="st"> </span>DynamicsIBD</a>
<a class="sourceLine" id="cb1-14" title="14"><span class="kw">colnames</span>(<span class="kw">tax_table</span>(ps1))</a></code></pre></div>
<p>As you can see the taxonomic classification is just lablled as “Rank1” … “Rank7”. We need to change this to proper designation and also do some formatting of the data. This can be a useful example for understanding simple file processing in R.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># First change the column names of the taxonomy table in phyloseq to following:</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">colnames</span>(<span class="kw">tax_table</span>(ps1)) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Kingdom&quot;</span>, <span class="st">&quot;Phylum&quot;</span>, <span class="st">&quot;Class&quot;</span>, <span class="st">&quot;Order&quot;</span>, <span class="st">&quot;Family&quot;</span>, <span class="st">&quot;Genus&quot;</span>, <span class="st">&quot;Species&quot;</span> )</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">tax_table</span>(ps1)[<span class="kw">tax_table</span>(ps1)[,<span class="st">&quot;Kingdom&quot;</span>]<span class="op">==</span><span class="st"> &quot;NA&quot;</span>, <span class="st">&quot;Kingdom&quot;</span> ] &lt;-<span class="st"> &quot;Unidentified_Kingdom&quot;</span></a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">tax_table</span>(ps1)[<span class="kw">tax_table</span>(ps1)[,<span class="st">&quot;Phylum&quot;</span>]<span class="op">==</span><span class="st"> &quot;p__&quot;</span>, <span class="st">&quot;Phylum&quot;</span> ] &lt;-<span class="st"> &quot;p__Unidentified_Phylum&quot;</span></a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co"># make a dataframe for taxonomy information.</span></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">taxic &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(ps1<span class="op">@</span>tax_table) </a>
<a class="sourceLine" id="cb2-12" title="12">otu.df &lt;-<span class="st"> </span><span class="kw">abundances</span>(ps1)</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co"># make a dataframe for OTU information.</span></a>
<a class="sourceLine" id="cb2-15" title="15">otu.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(otu.df)</a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co"># check the rows and columns</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co"># head(otu.df) </span></a>
<a class="sourceLine" id="cb2-19" title="19"></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co"># Add the OTU ids from OTU table into the taxa table at the end.</span></a>
<a class="sourceLine" id="cb2-21" title="21">taxic<span class="op">$</span>OTU &lt;-<span class="st"> </span><span class="kw">row.names.data.frame</span>(otu.df) </a>
<a class="sourceLine" id="cb2-22" title="22"></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co"># You can see that we now have extra taxonomy levels.</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="kw">colnames</span>(taxic)</a>
<a class="sourceLine" id="cb2-25" title="25"></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co"># convert it into a matrix.</span></a>
<a class="sourceLine" id="cb2-27" title="27">taxmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(taxic)</a>
<a class="sourceLine" id="cb2-28" title="28"></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co"># convert into phyloseq compaitble file.</span></a>
<a class="sourceLine" id="cb2-30" title="30">new.tax &lt;-<span class="st"> </span><span class="kw">tax_table</span>(taxmat)  </a>
<a class="sourceLine" id="cb2-31" title="31"></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co"># incroporate into phyloseq Object</span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="kw">tax_table</span>(ps1) &lt;-<span class="st"> </span>new.tax </a></code></pre></div>
<div id="composition-barplots" class="section level1">
<h1>Composition barplots</h1>
<p>The compositon plots can be shown either as barplots or heatmaps. Both examples are show below.</p>
<div id="plot-relative-abundance" class="section level2">
<h2>Plot relative abundance</h2>
<p>Now we can improve the plot further.<br />
Let’s try at Family level.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(phyloseq)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co"># for example purpose we will remove samples with less than 10000</span></a>
<a class="sourceLine" id="cb3-3" title="3">ps2 =<span class="st"> </span><span class="kw">prune_samples</span>(<span class="kw">sample_sums</span>(ps1)<span class="op">&gt;=</span><span class="dv">2000</span>, ps1)</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co"># To speed up the example we will use only those OTUs that are detected 100 times and present in 50% of the samples.</span></a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">pseq2 &lt;-<span class="st"> </span>microbiome<span class="op">::</span><span class="kw">core</span>(ps2, <span class="dt">detection =</span> <span class="dv">100</span>, <span class="dt">prevalence =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co"># Improve the plotting</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="kw">tax_table</span>(pseq2)[<span class="kw">tax_table</span>(pseq2)[,<span class="st">&quot;Family&quot;</span>]<span class="op">==</span><span class="st"> &quot;f__&quot;</span>, <span class="st">&quot;Family&quot;</span> ] &lt;-<span class="st"> &quot;f__Unclassified Family&quot;</span></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co"># We will also remove the &quot;f__&quot; patterns for cleaner labels</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="kw">tax_table</span>(pseq2)[,<span class="kw">colnames</span>(<span class="kw">tax_table</span>(pseq2))] &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="kw">tax_table</span>(pseq2)[,<span class="kw">colnames</span>(<span class="kw">tax_table</span>(pseq2))],<span class="dt">pattern=</span><span class="st">&quot;[a-z]__&quot;</span>,<span class="dt">replacement=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb3-14" title="14"></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co"># merge at family level.</span></a>
<a class="sourceLine" id="cb3-16" title="16"></a>
<a class="sourceLine" id="cb3-17" title="17">pseq.fam &lt;-<span class="st"> </span><span class="kw">aggregate_taxa</span>(pseq2, <span class="st">&quot;Family&quot;</span>)</a>
<a class="sourceLine" id="cb3-18" title="18"></a>
<a class="sourceLine" id="cb3-19" title="19">p.fam &lt;-<span class="st"> </span><span class="kw">plot_composition</span>(pseq.fam, <span class="dt">sample.sort =</span> <span class="ot">NULL</span>, <span class="dt">otu.sort =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="dt">x.label =</span> <span class="st">&quot;ibd_subtype&quot;</span>, <span class="dt">plot.type =</span> <span class="st">&quot;barplot&quot;</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-21" title="21"></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="kw">print</span>(p.fam)</a></code></pre></div>
</div>
<div id="plot-relative-abundance-1" class="section level2">
<h2>Plot relative abundance</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">pseq.famrel &lt;-<span class="st"> </span><span class="kw">transform</span>(pseq.fam, <span class="st">&quot;compositional&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">p.famrel &lt;-<span class="st"> </span><span class="kw">plot_composition</span>(pseq.famrel, <span class="dt">sample.sort =</span> <span class="ot">NULL</span>, <span class="dt">otu.sort =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="dt">x.label =</span> <span class="st">&quot;ibd_subtype&quot;</span>, <span class="dt">plot.type =</span> <span class="st">&quot;barplot&quot;</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">print</span>(p.famrel)</a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co"># further improvements can be done as follows  </span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">p.famrel &lt;-<span class="st"> </span><span class="kw">plot_composition</span>(pseq.famrel, </a>
<a class="sourceLine" id="cb4-11" title="11">                             <span class="dt">sample.sort =</span> <span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb4-12" title="12">                             <span class="dt">otu.sort =</span> <span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb4-13" title="13">                             <span class="dt">x.label =</span> <span class="st">&quot;ibd_subtype&quot;</span>, </a>
<a class="sourceLine" id="cb4-14" title="14">                             <span class="dt">plot.type =</span> <span class="st">&quot;barplot&quot;</span>, </a>
<a class="sourceLine" id="cb4-15" title="15">                             <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">ncol =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="st">  </span><span class="kw">scale_y_percent</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Samples&quot;</span>, </a>
<a class="sourceLine" id="cb4-19" title="19">       <span class="dt">y =</span> <span class="st">&quot;Relative abundance (%)&quot;</span>,</a>
<a class="sourceLine" id="cb4-20" title="20">       <span class="dt">title =</span> <span class="st">&quot;Relative abundance data&quot;</span>, </a>
<a class="sourceLine" id="cb4-21" title="21">       <span class="dt">subtitle =</span> <span class="st">&quot;Subtitle&quot;</span>,</a>
<a class="sourceLine" id="cb4-22" title="22">       <span class="dt">caption =</span> <span class="st">&quot;Caption text.&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="st">     </span><span class="kw">theme_ipsum</span>(<span class="dt">grid=</span><span class="st">&quot;Y&quot;</span>)</a>
<a class="sourceLine" id="cb4-24" title="24"></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="kw">print</span>(p.famrel)</a></code></pre></div>
<p>Average by group</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Averaged by group</span></a>
<a class="sourceLine" id="cb5-2" title="2">p &lt;-<span class="st"> </span><span class="kw">plot_composition</span>(pseq.famrel,</a>
<a class="sourceLine" id="cb5-3" title="3">                      <span class="dt">average_by =</span> <span class="st">&quot;ibd_subtype&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">ncol =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="st">  </span><span class="kw">scale_y_percent</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Samples&quot;</span>, </a>
<a class="sourceLine" id="cb5-7" title="7">       <span class="dt">y =</span> <span class="st">&quot;Relative abundance (%)&quot;</span>,</a>
<a class="sourceLine" id="cb5-8" title="8">       <span class="dt">title =</span> <span class="st">&quot;Relative abundance data&quot;</span>, </a>
<a class="sourceLine" id="cb5-9" title="9">       <span class="dt">subtitle =</span> <span class="st">&quot;Subtitle&quot;</span>,</a>
<a class="sourceLine" id="cb5-10" title="10">       <span class="dt">caption =</span> <span class="st">&quot;Caption text.&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="st">     </span><span class="kw">theme_ipsum</span>(<span class="dt">grid=</span><span class="st">&quot;Y&quot;</span>)</a>
<a class="sourceLine" id="cb5-12" title="12"></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="kw">print</span>(p)</a></code></pre></div>
</div>
</div>
<div id="heatmap-composition" class="section level1">
<h1>Heatmap composition</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">pseq.famlog &lt;-<span class="st"> </span><span class="kw">transform</span>(pseq.fam, <span class="st">&quot;log10&quot;</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3">p.famrel.heatmap &lt;-<span class="st"> </span><span class="kw">plot_composition</span>(pseq.famlog, </a>
<a class="sourceLine" id="cb6-4" title="4">                             <span class="dt">sample.sort =</span> <span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb6-5" title="5">                             <span class="dt">otu.sort =</span> <span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb6-6" title="6">                             <span class="dt">x.label =</span> <span class="st">&quot;ibd_subtype&quot;</span>, </a>
<a class="sourceLine" id="cb6-7" title="7">                             <span class="dt">plot.type =</span> <span class="st">&quot;heatmap&quot;</span>, </a>
<a class="sourceLine" id="cb6-8" title="8">                             <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="kw">print</span>(p.famrel.heatmap)</a></code></pre></div>
</div>
<div id="plot-taxa-prevalence" class="section level1">
<h1>Plot taxa prevalence</h1>
<p>We use the Dynamics IBD data set from <a href="http://www.nature.com/articles/nmicrobiol20174">Halfvarson J., et al. Nature Microbiology, 2017</a> as downloaded from <a href="https://qiita.ucsd.edu/study/description/1629">Qiita ID 1629</a>. This function allows you to have an overview of OTU prevalences alongwith their taxonomic affiliations. This will aid in checking if you filter OTUs based on prevalence, then what taxonomic affliations will be lost.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># We will use the ps1 object we created previously.</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">print</span>(ps1)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co"># Use sample and taxa subset to speed up example</span></a>
<a class="sourceLine" id="cb7-4" title="4">p0 &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps1, sex <span class="op">==</span><span class="st"> &quot;male&quot;</span> <span class="op">&amp;</span><span class="st"> </span>timepoint <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co"># For the available taxonomic levels</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw">plot_taxa_prevalence</span>(p0, <span class="st">&quot;Phylum&quot;</span>)</a></code></pre></div>
</div>
</div>


</div>

<div id="postamble" data-toggle="wy-nav-shift" class="status">
<p class="author"><span class="glyphicon glyphicon-user"></span> Leo Lahti, Sudarshan Shetty et al. 2019-07-26</p>
</div>


<script>
$(document).ready(function () {
 	 	$('#content img')
 	  .addClass("image-thumb");
      $('#content img')
 	  .addClass("image-lb");
  $('#content').magnificPopup({
	      type:'image',
	      closeOnContentClick: false,
	      closeBtnInside: false,
	      delegate: 'img',
	      gallery: {enabled: true },
	      image: {
	        verticalFit: true,
          titleSrc: 'alt'
	      }
 	    });
 	});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
